# Task 04

> Tên tài liệu: Lỗ hỏng SQL Injection.

> Thực hiện: Nguyễn Minh Nhật

> Cập nhật lần cuối: 07/02/2017

## Mục lục:

[1.Lỗ hỏng SQL Injection là gì ?](#injection)

[2.Các bước tấn công, giải LV 1.](#actack)



## Nội dung.

<a name="injection"></a>

### 1.Lỗ hỏng SQL Injection là gì ?

- **?** Khi người dùng nhập vào 1 giữ liệu có thể là `user` hay `pass`  và PHP tương tác với CSDL để trả về hay kiểm tra nội dung đó và trả về kết quả cho người dùng.

- Ta xét *Ví dụ* 1 form đăng nhập.

![a](http://imageshack.com/a/img924/7037/LfZ0IC.png)

- Khi ta nhập dữ liệu vào form đó và nhấn `Enter` thì để xử lí ta có mã code PHP như sau:

![a](http://imageshack.com/a/img922/6455/Sq8Z5N.png)

- Rõ ràng dữ liệu của chúng ta nhập vào có thể được lưu trong 1 biến ở đây là biến `$username` và `$password` và được mã code PHP xử lí.

- Nếu ta nhập đúng thì đăng nhập được, nếu sai thì báo lỗi.

- Và mọi người để ý dữ liệu của chúng ta đều được bao bọc trong dấu `" "` hoặc `' '`.

- Vậy nếu chúng ta nhập `user` là minhnhat OR '1'='1' thì vẫn đăng nhập được vì 1=1 và phép `OR` chỉ cần đúng 1 trong 2 vế là  OK rồi.

- Ta xem mã code PHP khi thêm `OR '1'='1'` nhé.

![a](http://imageshack.com/a/img923/1881/AIUM7O.png) 

- Rõ ràng câu truy vấn trên hợp lệ mặc dù chúng ta không biết `user` và `pass` thì vẫn đăng nhập vào được.

- **Vậy Lỗ hỏng SQL Injection là gì ?**

> SQL Injection là việc hacker lợi dụng lỗi khi người dùng nhập vào 1 input với câu truy vấn lấy dữ liệu của các website không an toàn.

<a name="actack"></a>

### 2. Các bước tấn công, giải LV 1.

- Ta lấy *ví dụ* 1 trang web như sau:

![a](http://imageshack.com/a/img922/9633/CCZzxB.png)

- Chúng ta chú ý đến biến `name`=`root`

- **B1**: Ta sẽ kiểm tra xem các website có bị lỗi `SQL Injection` không.

- Bằng các ta thêm vào 1 số kí tự như : `'`,`"`. Nếu như website bị lỗi SQL Injection sẽ hiễn thị thông báo lỗi hoặc trả về trình duyệt dữ liệu không như ban đầu.

- Ở đây dữ liệu webite bị mất => Lỗi SQL Injection.

![a](http://imageshack.com/a/img922/3370/jcOTMt.png)

- **B2**: Ta sẽ sử dụng `ORDER BY` để kiểm tra số `cột` trong CSDL.

- Cú pháp ta cứ `ORDER BY 1,2,..,n-- -` để kiểm tra.

- Kí tự `-- -` được hiểu như bỏ tất cả các câu truy vấn phía sau, xem nó như chú thích.

- *Ví dụ*: Ta kiểm tra `ORDER BY 1,2,3,4,5-- -` và website vẫn load bình thường.

![a](http://imageshack.com/a/img924/1711/zyS6eO.png)

- Tiếp theo ta tăng số cột lên `ORDER BY 1,2,3,4,5,6-- -` website không có gì, hoặc thông báo lỗi => chỉ có 5 cột.

![a](http://imageshack.com/a/img923/6091/iII9f7.png)

- **B3**: Ta sử dụng `UNION SELECT 1,2,3,4,5-- -` để kiểm tra cột bị lỗi, từ đó thực hiện khai thác trên các cột đó.

![a](http://imageshack.com/a/img924/3782/Tz8tw2.png)

- Ta tìm được cột bị lỗi là 1,2,3.

- **B4**: Ta tiến hành khai thác các dữ liệu cần thiết trên các cột đó như phiên bản version(), tên CSDL database().

![a](http://imageshack.com/a/img922/442/6nalyK.png)
![a](http://imageshack.com/a/img922/3324/6QENlz.png)


- **Mục tiêu của ta là tìm được table chứa `user` và `password` của `admin`**

- Tiếp theo ta sẽ tìm các `table` trong CSDL bằng câu lệnh: `union select 1,2,table_name,4,5 from information_schema.tables where table_schema=database()-- -`.

> table_name: đại diện cho tất cả tên `table` trong CSDL.

> information_schema.tables: được hiểu như nơi chứa tất cả các `table` trong CSDL.

> table_schema : đại diện cho tên 1 CSDL có chứa `table`.

![a](http://imageshack.com/a/img922/8625/Neuw45.png)

- Ta tìm được tên table là `users`.

- Tiếp theo ta tìm tên những cột có trong table `users` bằng câu lệnh: `union select 1,2,column_name,4,5 from information_schema.columns where table_name='user'-- -`

> column_name: đại diện cho tất cả tên cột trong CSDL.

> information_schema.columns: nơi chứa tất cả các `colum` trong CSDL.

![a](http://imageshack.com/a/img924/2967/PC7aRF.png)

- Ta thu được kết quả tên 5 cột: `id`, `name`, `age`, `	groupid`, `passwd`.

- Tiếp theo ta sẽ lấy dữ liệu trong cột `name` và `passwd` bằng câu lệnh: `union select 1,2,group_cat(name,0x3a,passwd),4,5 from users-- -`.

> group_concat(): dùng để nối chuỗi cho dễ nhìn.

> 0x3a: là mã hexa hiển thị dấu `:`.

- Ta thu được kết quả như hình, có 4 accout: `admin`, `root`, `user1`, `user2` ứng với mật khẩu là `admin`, `admin21`, `secret`, `azerty`.

![a](http://imageshack.com/a/img924/176/vn8uhx.png)

### *Thanks you for watching !*









