# Task 04

> Tên tài liệu: Lỗ hỏng SQL Injection.

> Thực hiện: Nguyễn Minh Nhật

> Cập nhật lần cuối: 07/02/2017

## Mục lục:

[1. Code lỗi ](#loi)

[2. Cách khắc phục](#overcom)

## Nội dung.

<a name="loi"></a>

## 1. Code lỗi trên.

- Lỗi trên xuất phát ta chưa mã hóa các dấu escap như `'`, `"`...

- Và truyền biến bằng `method` `get`.

![a](http://imageshack.com/a/img924/8153/h7Vh2h.png)

- Ta có 1 CSDL tên `da_cap` có table `thanh_vien`, có dữ liệu như sau.

![a](http://imageshack.com/a/img922/990/bRrOwC.png)

- Ta có 1 form đăng nhập như sau.

![a](http://imageshack.com/a/img922/7366/P1EbhQ.png)

- Mã htlm của form như sau.

![a](http://imageshack.com/a/img922/8691/Q4v3yy.png)

- Mã PHP xử lí form như sau. 

![a](http://imageshack.com/a/img923/7194/aY2tm4.png)

- Bây giờ ta thử đăng nhập 1 tai khoản bất kì có trong CSDL và form trả về `OK`.

![a](http://imageshack.com/a/img922/6065/MrT84Q.png)

- Ta thử nhập `'OR ''='` vào xem sao. 

![a](http://imageshack.com/a/img923/1081/pSCu2H.png)

- Vẫn báo `OK` mặc dù ta không nhập đúng tài khoản và mật khẩu.

## 2. Cách khắc phục.

- Ta sử dụng hàm `mysqli_real_escape_string` cho 2 biến `$username` và `$password`.

![a](http://imageshack.com/a/img922/6515/cYGHGh.png)

- Ta nhập `'OR ''='` và kiểm tra thử.

![a](http://imageshack.com/a/img924/9487/C6ARLj.png)

- Thông báo `No` vậy là hàm của chúng ta đã hoạt động chuyển chuỗi ban đầu thành 1 chuỗi truy vấn an toàn.

- Ta cũng có thể ép kiểu cho biến. 

- *Ví dụ*: `$a = (string)$_GET['name']`

- Ta sử dụng hàm str_replace() để loại bỏ những kí tự không phải là chuỗi.
  
- *Ví dụ*:  `$b = $GET['home']` 
-`$b = str_replace('/[^a-zA-Z]/', '', $b)`.
            

